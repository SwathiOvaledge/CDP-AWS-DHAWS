USE ROLE ENT_ENGAGE_OWNER_{{ENVR}}_ROLE;
USE DATABASE ENT_STG_ENGAGE_{{DB_SUFFIX}};
USE SCHEMA LOAD_STG;

create or replace external table LOAD_STG.BTP_CVD_MD_DS_GP_FLAGS_INCR_EXT(
	WBS_CODE VARCHAR(16777216) AS (NULLIF(CAST(GET($1, 'WBS_CODE') AS VARCHAR(16777216)), '')),
	DNA_FLAG VARCHAR(16777216) AS (NULLIF(CAST(GET($1, 'DNA_FLAG') AS VARCHAR(16777216)), '')),
	MT_FLAG VARCHAR(16777216) AS (NULLIF(CAST(GET($1, 'MT_FLAG') AS VARCHAR(16777216)), '')),
	POP_FLAG VARCHAR(16777216) AS (NULLIF(CAST(GET($1, 'POP_FLAG') AS VARCHAR(16777216)), '')),
	SRP_FLAG VARCHAR(16777216) AS (NULLIF(CAST(GET($1, 'SRP_FLAG') AS VARCHAR(16777216)), '')),
	IOT_FLAG VARCHAR(16777216) AS (NULLIF(CAST(GET($1, 'IOT_FLAG') AS VARCHAR(16777216)), '')),
	ANALYTICS_FLAG VARCHAR(16777216) AS (NULLIF(CAST(GET($1, 'ANALYTICS_FLAG') AS VARCHAR(16777216)), '')),
	DIGITAL_FLAG VARCHAR(16777216) AS (NULLIF(CAST(GET($1, 'DIGITAL_FLAG') AS VARCHAR(16777216)), '')),
	DESIGN_FLAG VARCHAR(16777216) AS (NULLIF(CAST(GET($1, 'DESIGN_FLAG') AS VARCHAR(16777216)), '')),
	ACCL_FLAG VARCHAR(16777216) AS (NULLIF(CAST(GET($1, 'ACCL_FLAG') AS VARCHAR(16777216)), '')),
	DNA_POWERED_FLAG VARCHAR(16777216) AS (NULLIF(CAST(GET($1, 'DNA_POWERED_FLAG') AS VARCHAR(16777216)), '')),
	LEAP_FLAG VARCHAR(16777216) AS (NULLIF(CAST(GET($1, 'LEAP_FLAG') AS VARCHAR(16777216)), '')),
	MCK_TECH_ENBLD_FLAG VARCHAR(16777216) AS (NULLIF(CAST(GET($1, 'MCK_TECH_ENBLD_FLAG') AS VARCHAR(16777216)), '')),
	UPDATE_DATE  TIMESTAMP AS ($1:UPDATE_DATE::TIMESTAMP),
	TOPIC_PARTITION NUMBER(38,0) AS (TO_NUMBER(GET($1, 'topic_partition'))),
	OFFSET NUMBER(38,0) AS (TO_NUMBER(GET($1, 'offset'))),
	TOPIC_RECORD_TIMESTAMP VARCHAR(16777216) AS (NULLIF(CAST(GET($1, 'topic_record_timestamp') AS VARCHAR(16777216)), '')),
	LOAD_DATE TIMESTAMP_NTZ(9) AS (TO_TIMESTAMP_NTZ((SPLIT_PART(SPLIT_PART(METADATA$FILENAME, '/', 5), '=', 2)) || (SPLIT_PART(SPLIT_PART(METADATA$FILENAME, '/', 6), '=', 2)), 'YYYY-MM-DDHH')))
partition by (LOAD_DATE)
location=@STG_ENGAGE/btp/incr/formatted/fct-btphana.cvd-md-ds-gp-flags/
file_format=FF.PARQUET_FORMAT
;